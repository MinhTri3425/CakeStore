<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
    <div th:replace="~{fragments/admin/header :: header-css}"></div>
    <title>Quản lý Danh mục</title>
</head>
<body class="layout-fixed sidebar-expand-lg">
<div class="app-wrapper"> 

	<div th:replace="~{fragments/admin/header :: header}"></div>
	
	<div th:replace="~{admin/home :: sidebar}"></div>

	<main class="app-main">
		<div class="app-content-header">
            <div class="container-fluid">
                <div class="row">
                    <div class="col-sm-6"><h3 class="mb-0">Quản lý Danh mục</h3></div>
                    <div class="col-sm-6">
                        <ol class="breadcrumb float-sm-end">
                            <li class="breadcrumb-item"><a th:href="@{/admin/home}">Home</a></li>
                            <li class="breadcrumb-item active" aria-current="page">Danh mục</li>
                        </ol>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="app-content">
            <div class="container-fluid">
                
				<div th:if="${success}" class="alert alert-success alert-dismissible fade show" role="alert" th:text="${success}"></div>
				<div th:if="${error}" class="alert alert-danger alert-dismissible fade show" role="alert" th:text="${error}"></div>

				<div class="card mb-4">
					<div class="card-header">
						<h3 class="card-title">Bộ lọc và Tìm kiếm</h3>
					</div>
					<div class="card-body">
						<form class="row g-2 align-items-end" method="get"
							th:action="@{/admin/categories}">
							<div class="col-md-4">
								<label class="form-label">Tìm kiếm (Tên/Slug)</label> <input
									type="text" class="form-control" name="q" th:value="${q}">
							</div>

							<div class="col-md-2">
								<label class="form-label">Trạng thái</label> <select
									class="form-select" name="status">
									<option value="all" th:selected="${status=='all'}">Tất
										cả</option>
									<option value="active" th:selected="${status=='active'}">Active</option>
									<option value="disabled" th:selected="${status=='disabled'}">Disabled</option>
								</select>
							</div>

							<div class="col-md-2">
								<label class="form-label">Mỗi trang</label> <select
									class="form-select" name="size">
									<option th:selected="${size==5}">5</option>
									<option th:selected="${size==10}">10</option>
									<option th:selected="${size==20}">20</option>
									<option th:selected="${size==50}">50</option>
								</select>
							</div>

							<div class="col-md-4 d-flex gap-2 justify-content-end">
								<a th:href="@{/admin/categories/new}" class="btn btn-primary">Thêm
									Danh mục</a>
								<button type="submit" class="btn btn-info">Lọc</button>
							</div>

							<input type="hidden" name="sort" th:value="${sort}"> <input
								type="hidden" name="dir" th:value="${dir}">
						</form>
					</div>
				</div>

				<div class="card">
					<div class="card-header"><h3 class="card-title">Danh sách Danh mục</h3></div>
					<div class="card-body p-0">
						<table class="table table-bordered table-striped align-middle">
							<thead class="table-dark">
								<tr>
									<th style="width: 80px"><a
										class="link-light text-decoration-none"
										th:href="@{/admin/categories(q=${q},status=${status},page=${page},size=${size},sort='id',dir=${dir})}">ID</a>
									</th>
									<th><a class="link-light text-decoration-none"
										th:href="@{/admin/categories(q=${q},status=${status},page=${page},size=${size},sort='name',dir=${dir})}">Tên</a>
									</th>
									<th>Slug</th>
									<th>Danh mục Cha</th>
									<th style="width: 110px"><a
										class="link-light text-decoration-none"
										th:href="@{/admin/categories(q=${q},status=${status},page=${page},size=${size},sort='sortOrder',dir=${dir})}">Thứ
											tự</a></th>
									<th style="width: 120px">Trạng thái</th>
									<th style="width: 170px">Thao tác</th>
								</tr>
							</thead>
							<tbody>
								<tr th:each="cat : ${categories}">
									<td th:text="${cat.id}">1</td>
									<td th:text="${cat.name}">Bánh Kem</td>
									<td th:text="${cat.slug}">banh-kem</td>
									<td th:text="${cat.parent != null ? cat.parent.name : 'ROOT'}">ROOT</td>
									<td th:text="${cat.sortOrder}">0</td>
									<td><span th:if="${cat.active}" class="badge bg-success">Active</span>
										<span th:unless="${cat.active}" class="badge bg-danger">Disabled</span>
									</td>
									<td><a
										th:href="@{/admin/categories/{id}/edit(id=${cat.id})}"
										class="btn btn-sm btn-info">Sửa</a>
										<form th:action="@{/admin/categories/{id}/delete(id=${cat.id})}"
											method="post" style="display: inline"
											onsubmit="return confirm('Bạn có chắc chắn muốn xoá?')">
											<input type="hidden" th:if="${_csrf != null}"
												th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
											<button type="submit" class="btn btn-sm btn-danger">Xoá</button>
										</form></td>
								</tr>
							</tbody>
						</table>
					</div>
					
					<div class="card-footer clearfix">
						<div th:if="${#lists.isEmpty(categories)}"
							class="alert alert-info mb-0">Không có danh mục nào.</div>
							
						<div class="d-flex justify-content-between align-items-center" th:unless="${#lists.isEmpty(categories)}">
							<div class="small">
								Trang <span th:text="${pageData.number + 1}"></span> / <span
									th:text="${pageData.totalPages == 0 ? 1 : pageData.totalPages}"></span>,
								Tổng <span th:text="${pageData.totalElements}"></span> danh mục
							</div>

							<nav>
								<ul class="pagination mb-0">
									<li class="page-item"
										th:classappend="${pageData.first} ? 'disabled'"><a
										class="page-link"
										th:href="@{/admin/categories(q=${q},status=${status},size=${size},sort=${sort},dir=${dir},page=1)}">«</a>
									</li>
									<li class="page-item"
										th:classappend="${pageData.first} ? 'disabled'"><a
										class="page-link"
										th:href="@{/admin/categories(q=${q},status=${status},size=${size},sort=${sort},dir=${dir},page=${pageData.number})}">‹</a>
									</li>

									<li class="page-item"
										th:each="p : ${#numbers.sequence(T(java.lang.Math).max(1, pageData.number+1-2), T(java.lang.Math).min(pageData.totalPages, pageData.number+1+2))}"
										th:classappend="${p == pageData.number+1} ? 'active'"><a
										class="page-link" th:text="${p}"
										th:href="@{/admin/categories(q=${q},status=${status},size=${size},sort=${sort},dir=${dir},page=${p})}">1</a>
									</li>

									<li class="page-item"
										th:classappend="${pageData.last} ? 'disabled'"><a
										class="page-link"
										th:href="@{/admin/categories(q=${q},status=${status},size=${size},sort=${sort},dir=${dir},page=${pageData.number+2})}">›</a>
									</li>
									<li class="page-item"
										th:classappend="${pageData.last} ? 'disabled'"><a
										class="page-link"
										th:href="@{/admin/categories(q=${q},status=${status},size=${size},sort=${sort},dir=${dir},page=${pageData.totalPages})}">»</a>
									</li>
								</ul>
							</nav>
						</div>
					</div>
				</div>
            </div>
        </div>
    </main>

	<div th:replace="~{fragments/admin/footer :: footer}"></div>
	
</div> <div th:replace="~{fragments/admin/footer :: footer-scripts}"></div>
<script th:replace="~{admin/home :: script-active-sidebar}"></script>

</body>
</html>