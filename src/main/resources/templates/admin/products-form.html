<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
    <meta charset="UTF-8">
    <title th:text="${isEdit ? 'Chỉnh sửa Sản phẩm' : 'Thêm Sản phẩm Mới'}"></title>
    <link rel="stylesheet" th:href="@{/webjars/bootstrap/5.3.8/css/bootstrap.min.css}" />
    <link rel="stylesheet" th:href="@{/css/style.css}" />
</head>
<body>
    <div th:replace="~{fragments/header :: header}"></div>

    <div class="container mt-4">
        <h2 th:text="${isEdit ? 'Chỉnh sửa Sản phẩm: ' + product.name : 'Thêm Sản phẩm Mới'}" class="mb-4"></h2>
        
        <div th:if="${error}" class="alert alert-danger" role="alert">
            <span th:text="${error}"></span>
        </div>

        <form th:action="@{/admin/products}" th:object="${product}" method="post" enctype="multipart/form-data">
            <input type="hidden" th:field="*{id}" th:if="${isEdit}" />

            <div class="mb-3">
                <label for="name" class="form-label">Tên sản phẩm</label>
                <input type="text" th:field="*{name}" class="form-control" id="name" required>
            </div>
            
            <div class="row">
                <div class="mb-3 col-md-6">
                    <label for="sku" class="form-label">SKU (Mã hàng)</label>
                    <input type="text" th:field="*{sku}" class="form-control" id="sku" required>
                </div>
                <div class="mb-3 col-md-6">
                    <label for="slug" class="form-label">Slug (URL thân thiện)</label>
                    <input type="text" th:field="*{slug}" class="form-control" id="slug" required>
                </div>
            </div>

            <div class="mb-3">
                <label for="category" class="form-label">Danh mục</label>
                <select th:field="*{category}" class="form-select" id="category" required>
                    <option th:each="cat : ${categories}" 
                            th:value="${cat.id}" 
                            th:text="${cat.name}">Bánh Kem</option>
                </select>
            </div>

            <div class="row">
                <div class="mb-3 col-md-6">
                    <label for="price" class="form-label">Giá bán</label>
                    <input type="number" th:field="*{price}" class="form-control" id="price" min="0" step="0.01" required>
                </div>
                <div class="mb-3 col-md-6">
                    <label for="compareAtPrice" class="form-label">Giá so sánh (Giá cũ)</label>
                    <input type="number" th:field="*{compareAtPrice}" class="form-control" id="compareAtPrice" min="0" step="0.01">
                </div>
            </div>

            <div class="mb-3">
                <label for="shortDesc" class="form-label">Mô tả ngắn</label>
                <textarea th:field="*{shortDesc}" class="form-control" id="shortDesc" rows="3"></textarea>
            </div>

            <div class="mb-3">
                <label for="description" class="form-label">Mô tả chi tiết</label>
                <textarea th:field="*{description}" class="form-control" id="description" rows="5"></textarea>
            </div>
            
            <div class="mb-3 form-check">
                <input type="checkbox" th:field="*{status}" th:value="1" th:class="form-check-input" id="status" checked>
                <label class="form-check-label" for="status">Hiển thị (Status = 1)</label>
            </div>

            <hr/>
            
            <div class="mb-3">
                <label for="productImages" class="form-label">Hình ảnh Sản phẩm</label>
                <input type="file" name="productImages" id="productImages" class="form-control" multiple>
                
                <div th:if="${isEdit and not #lists.isEmpty(product.images)}" class="mt-3">
                    <p>Ảnh hiện tại:</p>
                    <div class="d-flex flex-wrap">
                        <div th:each="image : ${product.images}" class="me-2 mb-2">
                            <img th:src="${image.url}" alt="Ảnh sản phẩm" style="width: 100px; height: 100px; object-fit: cover; border: 1px solid #ddd;">
                            <a href="#" class="text-danger small d-block text-center">Xóa</a>
                        </div>
                    </div>
                </div>
            </div>

            <hr/>
            <h5 class="mb-3">Biến thể (Kích thước, Hương vị...)</h5>
            <div id="variants-container">
                <p class="text-muted">Chức năng thêm/sửa biến thể sẽ được tích hợp với JavaScript.</p>
            </div>
            
            <button type="submit" class="btn btn-primary" th:text="${isEdit ? 'Cập nhật Sản phẩm' : 'Thêm Sản phẩm'}"></button>
            <a th:href="@{/admin/products}" class="btn btn-secondary">Hủy</a>
        </form>
    </div>

    <div th:replace="~{fragments/footer :: footer}"></div>

    <script th:src="@{/webjars/bootstrap/5.3.8/js/bootstrap.bundle.min.js}"></script>
    </body>
</html>