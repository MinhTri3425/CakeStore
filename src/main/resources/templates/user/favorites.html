<!-- templates/user/favorites.html -->
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      th:replace="fragments/user/header :: layout(~{::body})">
<body style="background:#0b1220;color:#e5e7eb;font-family:'Inter',sans-serif;">

<style>
  :root{
    --bg:#0b1220;
    --card:#111827;
    --border:rgba(148,163,184,.25);
    --muted:#94a3b8;
    --text:#e5e7eb;
    --primary:#22c55e;
    --secondary:#60a5fa;
  }

  h3{
    font-weight:800;
    color:#d1fae5;
    margin-top:1rem;
    margin-bottom:1rem;
    text-shadow:0 0 10px rgba(34,197,94,.15);
  }

  .alert-info{
    background:rgba(30,41,59,.6);
    border:1px solid var(--border);
    color:var(--text);
    border-radius:12px;
  }
  .alert-info a{
    color:#60a5fa;
    text-decoration:none;
    font-weight:600;
  }
  .alert-info a:hover{
    text-decoration:underline;
  }

  /* Card style (reuse vibe từ home/category/search) */
  .card{
    background:var(--card);
    border:1px solid var(--border);
    border-radius:16px;
    overflow:hidden;
    transition:transform .2s, box-shadow .2s, border-color .2s;
  }
  .card:hover{
    transform:translateY(-3px);
    box-shadow:0 10px 24px rgba(34,197,94,.12), 0 0 0 1px rgba(96,165,250,.12);
    border-color:rgba(148,163,184,.35);
  }
  .card-img-top{
    height:180px;
    object-fit:cover;
    background:linear-gradient(135deg, rgba(96,165,250,.12), rgba(34,197,94,.12));
    border-bottom:1px solid var(--border);
  }
  .card-body{
    padding:14px 16px;
  }
  .card-title{
    color:#e8eef6;
    margin-bottom:.35rem;
  }
  .price{
    font-weight:800;
    color:#a5f3fc;
    font-size:1.05rem;
  }

  .card-footer{
    background:rgba(17,24,39,.6);
    border-top:1px solid var(--border);
    padding:.75rem;
    display:flex;
    justify-content:center;
    align-items:center;
    gap:.5rem;
    border-radius:0 0 16px 16px;
  }
  .card-footer form{
    margin:0;
    padding:0;
    display:flex;
    align-items:center;
  }

  /* nút tim đồng bộ */
  .btn-like{
    border-radius:12px;
    width:40px;
    height:40px;
    padding:0;
    display:flex;
    align-items:center;
    justify-content:center;
    font-weight:600;
    font-size:1rem;
    line-height:1;
    transition:all .18s;
    box-shadow:0 10px 24px rgba(0,0,0,.6);
  }
  /* trạng thái đã yêu thích (ở trang này tất cả đang được yêu thích) */
  .btn-like.on{
    border:2px solid rgba(239,68,68,1);
    background:radial-gradient(circle at 30% 30%, rgba(239,68,68,.9), rgba(139,0,0,.9) 70%);
    color:#fff;
    box-shadow:0 0 8px rgba(239,68,68,.8),0 24px 40px rgba(0,0,0,.9);
  }
  .btn-like.on:hover{
    filter:brightness(1.1);
    transform:translateY(-1px);
  }

  /* chi tiết */
  .btn-outline-secondary{
    border:1px solid rgba(148,163,184,.35);
    color:#cbd5e1;
    background:rgba(30,41,59,.4);
    border-radius:12px;
    font-weight:600;
    height:40px;
    display:flex;
    align-items:center;
    justify-content:center;
    transition:all .22s;
  }
  .btn-outline-secondary:hover{
    background:rgba(96,165,250,.16);
    border-color:rgba(148,163,184,.55);
    color:#fff;
    transform:translateY(-1px);
  }

  /* thêm giỏ */
  .btn-primary{
    background:linear-gradient(135deg, var(--primary), var(--secondary));
    border:none;
    color:#07131f;
    border-radius:12px;
    font-weight:800;
    box-shadow:0 6px 18px rgba(34,197,94,.25);
    height:40px;
    display:flex;
    align-items:center;
    justify-content:center;
    transition:transform .18s, filter .18s;
  }
  .btn-primary:hover{
    transform:translateY(-1px);
    filter:saturate(1.05);
  }
  .btn-primary:active{
    transform:scale(.97);
    box-shadow:inset 0 2px 8px rgba(0,0,0,.35);
  }
</style>

<div class="container">
  <h3 class="mt-2">Sản phẩm đã tim ❤️</h3>

  <!-- empty state -->
  <div th:if="${items == null or #lists.isEmpty(items)}" class="alert alert-info">
    Chưa có món nào yêu thích.
    <a href="/">Khám phá menu</a>
  </div>

  <!-- list favorites -->
  <div th:unless="${items == null or #lists.isEmpty(items)}"
       class="row row-cols-2 row-cols-md-4 g-3">

    <div class="col" th:each="p : ${items}">
      <div class="card h-100">

        <!-- ảnh sản phẩm -->
        <img th:if="${p.thumbnailUrl != null}"
             th:src="${p.thumbnailUrl}"
             class="card-img-top"
             alt="">
        <img th:if="${p.thumbnailUrl == null}"
             th:src="@{/images/no-image.png}"
             class="card-img-top"
             alt="no image">

        <!-- info -->
        <div class="card-body">
          <h6 class="card-title text-truncate" th:text="${p.name}">Tên bánh</h6>
          <div class="price"
               th:text="${#numbers.formatDecimal(p.price,1,0)} + ' đ'">
            0 đ
          </div>
        </div>

        <!-- actions -->
        <div class="card-footer">

          <!-- nút bỏ tim (toggle) -->
          <form th:action="@{/fav/toggle}" method="post" class="m-0 p-0">
            <input type="hidden" name="productId" th:value="${p.id}">
            <input type="hidden"
                   th:if="${_csrf!=null}"
                   th:name="${_csrf.parameterName}"
                   th:value="${_csrf.token}">
            <button type="submit"
                    class="btn-like on"
                    title="Bỏ yêu thích"
                    onclick="this.disabled=true;this.form.submit();">
              ♥
            </button>
          </form>

          <!-- xem chi tiết -->
          <a th:href="@{'/product/' + ${p.id}}"
             class="btn btn-sm btn-outline-secondary">
            Chi tiết
          </a>

          <!-- thêm giỏ -->
          <form th:action="@{/cart/add}" method="post" class="m-0 p-0">
            <input type="hidden"
                   th:if="${_csrf != null}"
                   th:name="${_csrf.parameterName}"
                   th:value="${_csrf.token}" />
            <input type="hidden" name="productId" th:value="${p.id}">
            <button class="btn btn-sm btn-primary">Thêm giỏ</button>
          </form>

        </div>
      </div>
    </div>

  </div>
</div>

</body>
</html>
